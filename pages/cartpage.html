<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amazon - Shopping Cart</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" 
        integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" 
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/toast.css">
    <link rel="stylesheet" href="../assets/css/cart.css">
</head>
<body>
    <div id="header-container"></div>

    <div class="cart-page-container">
        <h1 class="cart-main-heading">Shopping Cart</h1>
        
        <div id="cart-container">
            <div id="empty-cart-message" style="display: none;">
                <h3>Your Amazon Cart is empty</h3>
                <p><a href="../index.html">Continue Shopping</a></p>
            </div>
            <div id="cart-items">
                <!-- Cart items will be dynamically inserted here -->
            </div>
        </div>

        <div class="cart-summary" id="cart-summary-section" style="display: none;">
            <div class="cart-summary-box">
                <div class="cart-subtotal">
                    Subtotal (<span id="item-count">0</span> items): 
                    <span class="cart-subtotal-amount" id="cart-total">Rs 0</span>
                </div>
                <button id="checkout-button">Proceed to Checkout</button>
                <div class="continue-shopping">
                    <a href="../index.html">Continue Shopping</a>
                </div>
            </div>
        </div>
    </div>

    <div id="footer-container"></div>

    <script src="../assets/js/toast.js"></script>
    <script src="../assets/js/cart-manager.js"></script>
    <script src="../assets/js/footer.js" defer></script>
    <script src="../assets/js/header.js" defer></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            loadCart();
            
            // Listen for cart updates
            window.addEventListener('cartUpdated', function() {
                loadCart();
            });
        });

        function loadCart() {
            let cart = JSON.parse(localStorage.getItem("cart")) || [];
            let cartItemsContainer = document.getElementById("cart-items");
            let emptyCartMessage = document.getElementById("empty-cart-message");
            let cartSummarySection = document.getElementById("cart-summary-section");
            let cartTotal = document.getElementById("cart-total");
            let itemCount = document.getElementById("item-count");

            cartItemsContainer.innerHTML = "";
            let total = 0;
            let totalItems = 0;

            if (cart.length === 0) {
                emptyCartMessage.style.display = "block";
                cartSummarySection.style.display = "none";
                return;
            } else {
                emptyCartMessage.style.display = "none";
                cartSummarySection.style.display = "flex";
            }

            cart.forEach((product, index) => {
                let cartItem = document.createElement("div");
                cartItem.className = "cart-item";
                
                cartItem.innerHTML = `
                    <div class="cart-item-image">
                        <img src="${product.image}" alt="${product.name}">
                    </div>
                    <div class="cart-item-details">
                        <div class="cart-item-name">${product.name}</div>
                        <div class="cart-item-price">Rs ${product.price.toFixed(2)}</div>
                        <div class="cart-item-stock">In Stock</div>
                        <div class="cart-item-actions">
                            <div class="qty-selector">
                                <button class="qty-btn" onclick="decreaseQuantity(${index})">-</button>
                                <span class="qty-display">${product.quantity}</span>
                                <button class="qty-btn" onclick="increaseQuantity(${index})">+</button>
                            </div>
                            <button class="remove-btn" onclick="removeFromCart(${index})">Delete</button>
                        </div>
                    </div>
                `;

                cartItemsContainer.appendChild(cartItem);
                total += product.price * product.quantity;
                totalItems += product.quantity;
            });

            cartTotal.textContent = `Rs ${total.toFixed(2)}`;
            itemCount.textContent = totalItems;
        }

        function increaseQuantity(index) {
            if (window.CartManager) {
                window.CartManager.increaseQuantity(index);
            } else {
                let cart = JSON.parse(localStorage.getItem("cart")) || [];
                cart[index].quantity += 1;
                localStorage.setItem("cart", JSON.stringify(cart));
            }
            loadCart();
        }

        function decreaseQuantity(index) {
            if (window.CartManager) {
                window.CartManager.decreaseQuantity(index);
            } else {
                let cart = JSON.parse(localStorage.getItem("cart")) || [];
                if (cart[index].quantity > 1) {
                    cart[index].quantity -= 1;
                    localStorage.setItem("cart", JSON.stringify(cart));
                }
            }
            loadCart();
        }

        function removeFromCart(index) {
            if (confirm("Are you sure you want to remove this item from your cart?")) {
                let itemName = '';
                
                if (window.CartManager) {
                    const cart = window.CartManager.getCart();
                    itemName = cart[index]?.name || 'Item';
                    window.CartManager.removeItem(index);
                } else {
                    let cart = JSON.parse(localStorage.getItem("cart")) || [];
                    itemName = cart[index]?.name || 'Item';
                    cart.splice(index, 1);
                    localStorage.setItem("cart", JSON.stringify(cart));
                }
                
                loadCart();
                
                if (typeof showToast !== 'undefined') {
                    showToast(`${itemName} removed from cart`, 'info');
                }
            }
        }

        document.getElementById("checkout-button").addEventListener("click", function () {
            let cart = JSON.parse(localStorage.getItem("cart")) || [];
            if (cart.length === 0) {
                if (typeof showToast !== 'undefined') {
                    showToast('Your cart is empty. Add some items first!', 'warning');
                }
                return;
            }
            window.location.href = "checkout.html";
        });
    </script>
</body>
</html>

